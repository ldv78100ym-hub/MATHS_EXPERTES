<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S5 : √âquations Diophantiennes Lin√©aires (ax + by = c)</title>
    
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <script>
        // Configuration MathJax, standard pour toutes les s√©ances
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']], // D√©limiteurs inline $...$ et \(...\)
                displayMath: [['$$', '$$'], ['\\[', '\\]']] // D√©limiteurs display $$...$$ et \[...\]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>

    <style>
        /* CHARTE GRAPHIQUE FONDAMENTALE */
        body {
            font-family: 'Times New Roman', Times, serif;
            line-height: 1.6;
            margin: 0 auto;
            max-width: 900px;
            padding: 20px;
            color: #333;
            background-color: #f4f7f6; 
        }
        h1, h2, h3 {
            font-family: Arial, sans-serif;
            color: #004d99; /* Bleu fonc√© */
            border-bottom: 2px solid #004d99;
            padding-bottom: 5px;
            margin-top: 25px;
        }
        h1 { font-size: 2em; text-align: center; border-bottom: 3px double #004d99; }
        h2 { font-size: 1.5em; }
        h3 { font-size: 1.2em; border-bottom: 1px solid #ccc; }

        .section-box, .question-box {
            background-color: #ffffff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.05);
        }

        .course-box {
            background-color: #e6f7ff; /* Bleu tr√®s clair */
            border-left: 5px solid #004d99;
            padding: 15px;
            margin-bottom: 20px;
        }

        .exercice-title {
            color: #cc5200; /* Orange/Rouge */
            border-bottom: 1px solid #cc5200;
        }
        
        /* Styles pour les boutons d'aide/solution */
        .help-buttons {
            margin-top: 15px;
            text-align: right;
        }
        .help-button-action, .btn-generation {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
            font-size: 0.9em;
            transition: background-color 0.3s;
        }
        .btn-indication {
            background-color: #ffcc00; /* Jaune */
            color: #333;
        }
        .btn-solution {
            background-color: #33cc33; /* Vert */
            color: white;
        }
        .btn-generation {
            background-color: #0066cc; /* Bleu clair */
            color: white;
        }
        .help-content {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            display: none; /* Cach√© par d√©faut */
        }
        .help-indication {
            background-color: #fffacd; /* Jaune p√¢le */
            border: 1px dashed #ffcc00;
            font-style: italic;
        }
        .help-solution {
            background-color: #e5ffe5; /* Vert tr√®s p√¢le */
            border: 1px dashed #33cc33;
            font-style: normal; /* Normal pour la correction d√©taill√©e */
        }
        .diophantine-eq {
            font-size: 1.1em;
            font-weight: bold;
            color: #004d99;
            text-align: center;
            margin: 10px 0;
        }
        /* STYLE POUR LA R√âPONSE FINALE */
        .final-answer-box {
            font-size: 1.1em;
            font-weight: bold;
            padding: 10px;
            margin-top: 10px;
            border: 2px solid;
            border-radius: 5px;
        }
        .success {
            border-color: #33cc33;
            background-color: #e5ffe5;
            color: #008000;
        }
        .failure {
            border-color: #cc5200;
            background-color: #fff4e5;
            color: #cc5200;
        }
    </style>
</head>
<body>
    <h1>S5 : √âquations Diophantiennes Lin√©aires üìê</h1>

    <div class="section-box">
        <h2>I. Cours : L'√âquation $ax + by = c$</h2>
        <div class="course-box">
            <h3>1. Condition d'Existence des Solutions</h3>
            <p>L'√©quation diophantienne lin√©aire d'inconnues enti√®res $(x, y)$ est de la forme :</p>
            $$\text{(E) : } ax + by = c$$
            <p>o√π $a$, $b$, et $c$ sont des entiers relatifs donn√©s.</p>
            <p><strong>Th√©or√®me (Condition de r√©solution) :</strong> L'√©quation (E) admet des solutions enti√®res si et seulement si le PGCD de $a$ et $b$ divise $c$.</p>
            <p>En d'autres termes, si $d = \text{PGCD}(a, b)$, l'√©quation n'a de solution que si $c$ est un multiple de $d$ (c'est-√†-dire si $c \equiv 0 \pmod{d}$).</p>

            <h3>2. Recherche des Solutions</h3>
            <ol>
                <li><strong>Recherche d'une solution particuli√®re $(x_0, y_0)$ :</strong>
                    <ul>
                        <li>On applique l'algorithme d'Euclide √©tendu √† $a$ et $b$ pour trouver $u$ et $v$ tels que $au + bv = d$ (Th√©or√®me de B√©zout). </strong>$d$ est le PGCD$(a, b)$</strong>.</li>
                        <li>Comme $d$ divise $c$, on a $c = dk$ pour un certain entier $k$.</li>
                        <li>On multiplie l'√©galit√© de B√©zout par $k$: $a(uk) + b(vk) = dk = c$.</li>
                        <li>La solution particuli√®re est alors $(x_0 = uk, y_0 = vk)$.</li>
                    </ul>
                </li>
                <li><strong>D√©termination de la solution g√©n√©rale :</strong>
                    <ul>
                        <li>Les solutions g√©n√©rales sont donn√©es par :
                            $$x = x_0 + k b' \quad \text{et} \quad y = y_0 - k a', \quad k \in \mathbb{Z}$$
                            o√π $a' = \dfrac{a}{\text{PGCD}(a, b)}$ et $b' = \dfrac{b}{\text{PGCD}(a, b)}$.
                    </ul>
                </li>
            </ol>
        </div>
    </div>

    <h3 class="exercice-title">Exercice 1 : Application Directe de la M√©thode (Dynamique)</h3>
    <div id="container-ex1" class="question-box">
        <p id="ex1-question">R√©soudre dans $\mathbb{Z}^2$ l'√©quation diophantienne : <span class="diophantinen-eq" id="diophantine-equation">Chargement...</span></p>
        
        <div class="help-buttons">
            <button onclick="toggleHelp(this, 'help-ex1-ind1', 'Indication')" class="btn-indication help-button-action" data-content-id="help-ex1-ind1">Indication</button>
            <button onclick="toggleHelp(this, 'help-ex1-sol1', 'Solution (Compl√®te)')" class="btn-solution help-button-action" data-content-id="help-ex1-sol1">Solution (Compl√®te)</button>
            <button onclick="generateNewDiophantineProblem()" class="btn-generation">G√©n√©rer un nouvel exercice</button>
        </div>
        
        <div id="help-ex1-ind1" class="help-content help-indication">
            <strong>√âtape 1 :</strong> Calculer $\text{PGCD}(a, b)$. V√©rifier qu'il divise $c$.<br>
            <strong>√âtape 2 :</strong> Utiliser l'algorithme d'Euclide √©tendu pour trouver $u, v$ tels que $au + bv = \text{PGCD}(a, b)$.<br>
            <strong>√âtape 3 :</strong> D√©duire une solution particuli√®re $(x_0, y_0)$ en multipliant par le bon facteur.<br>
            <strong>√âtape 4 :</strong> √âcrire l'ensemble des solutions g√©n√©rales.
        </div>
        <div id="help-ex1-sol1" class="help-content help-solution">
            <p id="ex1-solution-content">Solution d√©taill√©e (Calcul en cours...)</p>
        </div>
    </div>
    
    <h3 class="exercice-title">Exercice 2 : √âquations sans Solution (Statique)</h3>
    <div id="container-ex2" class="question-box">
        <p id="ex2-question">Montrer que l'√©quation <span id="ex2-equation" class="diophantinen-eq">Chargement...</span> n'admet pas de solution dans $\mathbb{Z}^2$.</p>
        
        <div class="help-buttons">
            <button onclick="toggleHelp(this, 'help-ex2-sol1', 'Solution')" class="btn-solution help-button-action" data-content-id="help-ex2-sol1">Solution</button>
            <button onclick="generateNonSolvableProblem()" class="btn-generation">G√©n√©rer un nouvel exercice</button>
        </div>
        
        <div id="help-ex2-sol1" class="help-content help-solution">
            <p id="ex2-solution-content">Solution d√©taill√©e (Calcul en cours...)</p>
        </div>
    </div>

    <h3 class="exercice-title">Exercice 3 : Application et Contraintes (Difficile et Dynamique)</h3>
    <div id="container-ex3" class="question-box">
        <p id="ex3-question-text">Un marchand doit transporter exactement <strong id="ex3-weight">Chargement...</strong> de marchandises. Il dispose de sacs de <strong id="ex3-sacA">Chargement...</strong> et de sacs de <strong id="ex3-sacB">Chargement...</strong>.</p>
        <ol id="ex3-question-list">
            </ol>
        
        <div class="help-buttons">
            <button onclick="toggleHelp(this, 'help-ex3-ind1', 'Indication')" class="btn-indication help-button-action" data-content-id="help-ex3-ind1">Indication</button>
            <button onclick="toggleHelp(this, 'help-ex3-sol1', 'Solution (D√©taill√©e)')" class="btn-solution help-button-action" data-content-id="help-ex3-sol1">Solution (D√©taill√©e)</button>
            <button onclick="generateNewContrainedProblem()" class="btn-generation">G√©n√©rer un nouvel exercice</button>
        </div>
        
        <div id="help-ex3-ind1" class="help-content help-indication">
            <p id="ex3-indication-content"><strong>Indication :</strong> L'√©quation est $ax + by = c$. La solution g√©n√©rale est $\mathcal{S} = \{(x_0 + k \cdot b', y_0 - k \cdot a') \mid k \in \mathbb{Z} \}$. D√©terminez la plage de valeurs de $k$ pour que $x \geq 0$ et $y \geq 0$.</p>
        </div>
        <div id="help-ex3-sol1" class="help-content help-solution">
            <p id="ex3-solution-content">Solution d√©taill√©e (Calcul en cours...)</p>
        </div>
    </div>

    <div style="text-align: center; margin-top: 50px;">
        <button id="show-auteur-btn" onclick="toggleDisclaimer()" 
            style="padding: 10px 20px; font-size: 1em; cursor: pointer; border: none; border-radius: 5px; background-color: #333; color: white;">
            Auteur et Droits d'Auteur
        </button>
    </div>

    <div id="disclaimer-content" style="margin-top: 20px; padding: 20px; border: 1px solid #ddd; border-radius: 5px; background-color: #fff; display: none;">
        <h3>Droits d'Auteur et Source</h3>
            <p><strong>Auteur du probl√®me :</strong> Yann Merdy</p>
            <p><strong>Droits d'Auteur et Utilisation :</strong></p>
            <p>Ce contenu, y compris l'√©nonc√©, les solutions et le code interactif, est prot√©g√© par les droits d'auteur. <strong>Toute utilisation √† des fins commerciales, y compris la revente, la distribution ou l'int√©gration dans des produits commerciaux, est...</strong></p>
    </div>
    <script>
        // --- NOUVELLE FONCTION POUR DROITS D'AUTEUR (Identique √† S1) ---
        function toggleDisclaimer() {
            const disclaimer = document.getElementById('disclaimer-content');
            const button = document.getElementById('show-auteur-btn');
            const isVisible = disclaimer.style.display === 'block';

            if (isVisible) {
                disclaimer.style.display = 'none';
                button.textContent = 'Auteur et Droits d\'Auteur';
                button.style.backgroundColor = '#333';
            } else {
                disclaimer.style.display = 'block';
                button.textContent = 'Masquer les Droits d\'Auteur';
                button.style.backgroundColor = '#dc3545';
            }
        }
        // --- Fin NOUVELLE FONCTION ---
        
        // --- FONCTIONS UTILITAIRES MATH√âMATIQUES (PGCD, B√©zout & Fibonacci) ---
        
        /**
         * G√©n√®re un entier al√©atoire entre min et max (inclus).
         */
        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        /**
         * Calcule le PGCD de deux nombres.
         */
        function gcd(a, b) {
            a = Math.abs(a);
            b = Math.abs(b);
            while (b) {
                [a, b] = [b, a % b];
            }
            return a;
        }

        /**
         * Algorithme d'Euclide √âtendu (donne les coefficients de B√©zout)
         * Renvoie { g: PGCD(a,b), u: coeff_a, v: coeff_b } tel que a*u + b*v = g
         */
        function extendedEuclidean(a, b) {
            let u = 1, v = 0, u1 = 0, v1 = 1;
            let a_init = a, b_init = b;
            a = Math.abs(a);
            b = Math.abs(b);
            while (b) {
                const q = Math.floor(a / b);
                [a, b] = [b, a % b];
                [u, u1] = [u1, u - q * u1];
                [v, v1] = [v1, v - q * v1];
            }
            // Correction de signe si l'entr√©e √©tait n√©gative
            if (a_init < 0) u = -u;
            if (b_init < 0) v = -v;
            return { g: a, u: u, v: v };
        }
        
        // Fonction g√©n√©rique pour afficher/masquer l'aide/solution
        function toggleHelp(button, contentId, originalText) {
            const content = document.getElementById(contentId);
            const container = button.closest('.question-box');
            
            // Masquer tout contenu d'aide dans le m√™me conteneur sauf celui qui est cliqu√©
            container.querySelectorAll('.help-content').forEach(el => {
                if (el.id !== contentId && el.style.display !== 'none') {
                    el.style.display = 'none';
                }
            });
            // R√©initialiser les boutons des autres aides (Indication / Solution)
            container.querySelectorAll('.help-button-action').forEach(btn => {
                if (btn !== button && btn.textContent !== btn.getAttribute('data-content-id').includes('sol') ? 'Solution' : 'Indication') {
                    btn.textContent = btn.getAttribute('data-content-id').includes('sol') ? 'Solution (Compl√®te)' : 'Indication';
                    btn.style.backgroundColor = btn.classList.contains('btn-solution') ? '#33cc33' : '#ffcc00';
                }
            });

            if (content.style.display === 'block') {
                content.style.display = 'none';
                button.textContent = originalText;
                button.style.backgroundColor = button.classList.contains('btn-solution') ? '#33cc33' : '#ffcc00';
            } else {
                content.style.display = 'block';
                button.textContent = `Masquer ${originalText}`;
                button.style.backgroundColor = button.classList.contains('btn-solution') ? '#cc0000' : '#d1a400';
            }
        }

        // --- EXERCICE 1 : G√©n√©ration Dynamique d'une √âquation Diophantienne ---
        function generateNewDiophantineProblem() {
            // 1. G√©n√©rer a et b premiers entre eux pour simplifier ou non
            let a, b, d;
            do {
                a = getRandomInt(10, 40);
                b = getRandomInt(10, 40);
                d = gcd(a, b);
            } while (d > 5 || a === b || a % b === 0 || b % a === 0); 
            
            // 2. G√©n√©rer c, multiple de d
            const k_c = getRandomInt(5, 30) * (Math.random() < 0.5 ? 1 : -1);
            const c = d * k_c;

            // 3. Afficher l'√©quation
            const equationText = `${a}x + ${b}y = ${c}`;
            document.getElementById('diophantine-equation').textContent = equationText;
            
            // 4. Calculer la solution d√©taill√©e
            const euclideResult = extendedEuclidean(a, b);
            const u = euclideResult.u;
            const v = euclideResult.v;
            
            // Solution particuli√®re (x0, y0)
            const x0 = u * k_c;
            const y0 = v * k_c;
            
            // Param√®tres de la solution g√©n√©rale (a'=a/d, b'=b/d)
            const a_prime = a / d;
            const b_prime = b / d;

            let solContent = `
                <h3>Correction D√©taill√©e : Cas R√©soluble (L'√©quation : ${a}x + ${b}y = ${c})</h3>
                <p><strong>1. V√©rification de l'Existence :</strong></p>
                <ul>
                    <li>On calcule le Plus Grand Commun Diviseur (PGCD) : $\\text{PGCD}(${a}, ${b}) = \\mathbf{${d}}$.</li>
                    <li>On v√©rifie si ce PGCD divise $${c}$ : $${c} = ${d} \\times (${k_c})$. Oui, la condition est remplie.</li>
                </ul>
                <p><strong>2. Solution Particuli√®re $(x_0, y_0)$ :</strong></p>
                <ul>
                    <li>L'algorithme d'Euclide √©tendu donne la relation de B√©zout pour le PGCD : $${a}(${u}) + ${b}(${v}) = ${d}$$.</li>
                    <li>En multipliant par $k_c = ${k_c}$, on obtient la solution particuli√®re : $${a}(${x0}) + ${b}(${y0}) = ${c}$$.</li>
                </ul>
                <p>Une solution particuli√®re est $\\mathbf{x_0 = ${x0}}$ et $y_0 = ${y0}$.</p>
                <p><strong>3. Solution g√©n√©rale :</strong></p>
                <p>Les solutions $(x, y)$ v√©rifient $x = x_0 + k \\dfrac{b}{d}$ et $y = y_0 - k \\dfrac{a}{d}$.</p>
                <p>Avec $b/d = ${b_prime}$ et $a/d = ${a_prime}$, l'ensemble des solutions est :</p>
                $$\\mathcal{S} = \\{(${x0} + k \\cdot ${b_prime}, ${y0} - k \\cdot ${a_prime}) \\mid k \\in \\mathbb{Z} \\}$$
            `;
            document.getElementById('ex1-solution-content').innerHTML = solContent;
            
            // Masquer l'aide et r√©initialiser le bouton lors de la g√©n√©ration
            document.getElementById('help-ex1-ind1').style.display = 'none';
            document.getElementById('help-ex1-sol1').style.display = 'none';
            document.querySelector('#container-ex1 [data-content-id="help-ex1-ind1"]').textContent = 'Indication';
            document.querySelector('#container-ex1 [data-content-id="help-ex1-ind1"]').style.backgroundColor = '#ffcc00';
            document.querySelector('#container-ex1 [data-content-id="help-ex1-sol1"]').textContent = 'Solution (Compl√®te)';
            document.querySelector('#container-ex1 [data-content-id="help-ex1-sol1"]').style.backgroundColor = '#33cc33';

            // Re-typeset de l'√©quation et de la solution
            if (window.MathJax) {
                MathJax.typeset([document.getElementById('diophantine-equation').parentNode, document.getElementById('ex1-solution-content')]);
            }
        }

        // --- EXERCICE 2 : G√©n√©ration Dynamique d'une √âquation sans solution ---
        function generateNonSolvableProblem() {
            let a, b, d, c, r;
            // 1. G√©n√©rer a et b pour garantir PGCD(a,b) > 1
            do {
                a = getRandomInt(10, 40);
                b = getRandomInt(10, 40);
                d = gcd(a, b);
            } while (d === 1 || a === b || a % b === 0 || b % a === 0); 
            
            // 2. G√©n√©rer c non multiple de d
            const k_c = getRandomInt(5, 30) * (Math.random() < 0.5 ? 1 : -1);
            
            // Pour garantir que c ne soit pas divisible par d, on ajoute un reste r non nul
            // On veut c = d*k_c + r, avec 0 < r < d
            r = getRandomInt(1, d - 1);
            c = d * k_c + r;

            // 3. Afficher l'√©quation
            const equationText = `${a}x + ${b}y = ${c}`;
            document.getElementById('ex2-equation').textContent = equationText;

            // 4. Calculer la solution d√©taill√©e
            let solContent = `
                <h3>Correction D√©taill√©e : Cas Non R√©soluble (L'√©quation : ${a}x + ${b}y = ${c})</h3>
                <p><strong>1. Mod√©lisation :</strong></p>
                <p>L'√©quation est : $${a}x + ${b}y = ${c}$</p>
                <p><strong>2. Condition d'Existence des solutions :</strong></p>
                <p>L'√©quation admet des solutions dans $\\mathbb{Z}^2$ si et seulement si $\\text{PGCD}(a, b)$ divise $c$.</p>
                <p>On calcule $\\text{PGCD}(${a}, ${b}) = \\mathbf{${d}}$.</p>
                <p>On effectue la division euclidienne de $c$ par $d$ :</p>
                $$${c} = ${k_c} \\times ${d} + ${r}$$
                <p>Le reste $\\mathbf{${r}}$ est non nul.</p>
                <p>Par cons√©quent, $\\text{PGCD}(${a}, ${b}) = ${d}$ ne divise pas $${c}$. L'√©quation $\\mathbf{${a}x + ${b}y = ${c}}$ n'admet <strong>aucune</strong> solution dans $\\mathbb{Z}^2$.</p>
            `;
            document.getElementById('ex2-solution-content').innerHTML = solContent;
            
            // 5. Masquer l'aide et r√©initialiser le bouton lors de la g√©n√©ration (pour √©viter les chevauchements)
            document.getElementById('help-ex2-sol1').style.display = 'none';
            document.querySelector('#container-ex2 [data-content-id="help-ex2-sol1"]').textContent = 'Solution';
            document.querySelector('#container-ex2 [data-content-id="help-ex2-sol1"]').style.backgroundColor = '#33cc33';

            // 6. Assure le rendu MathJax
            if (window.MathJax) {
                MathJax.typeset([document.getElementById('ex2-equation').parentNode, document.getElementById('ex2-solution-content')]);
            }
        }

        // --- EXERCICE 3 : G√©n√©ration Dynamique d'un Probl√®me avec Contraintes (CORRIG√â) ---
        function generateNewContrainedProblem() {
            let a, b, c, d;

            // 1. G√©n√©rer a et b (PGCD > 1) et c (multiple du PGCD) pour garantir des solutions
            do {
                a = getRandomInt(5, 15);
                b = getRandomInt(5, 15);
                d = gcd(a, b);
            } while (d === 1 || a === b || a % b === 0 || b % a === 0); 
            
            // Assurer que la solution non nulle est r√©aliste (c assez grand)
            const k_c = getRandomInt(10, 30);
            c = d * k_c; 

            // 2. Afficher la question
            document.getElementById('ex3-weight').textContent = c;
            document.getElementById('ex3-sacA').textContent = a;
            document.getElementById('ex3-sacB').textContent = b;

            let questionListHTML = `
                <li><strong>Mod√©lisation :</strong> √âcrire l'√©quation diophantienne lin√©aire mod√©lisant le probl√®me, o√π $x$ est le nombre de sacs de ${a} kg et $y$ est le nombre de sacs de ${b} kg.</li>
                <li><strong>R√©solution g√©n√©rale :</strong> D√©terminer l'ensemble des solutions enti√®res $(x, y)$ de cette √©quation.</li>
                <li><strong>Contraintes :</strong> D√©terminer l'ensemble des solutions positives ou nulles (c'est-√†-dire avec $x \\geq 0$ et $y \\geq 0$)</li>
                <li><strong>Minimisation :</strong> Si l'√©quation a des solutions positives, trouver le nombre <strong>minimum total de sacs</strong> que le marchand doit utiliser, en tenant compte des contraintes $x \\geq 0$ et $y \\geq 0$.</li>
            `;

            // Solution Calculation
            const euclideResult = extendedEuclidean(a, b);
            const u = euclideResult.u;
            const v = euclideResult.v;
            const k_c_calc = c / d; // Should be an integer

            // Particular solution (x0, y0)
            const x0 = u * k_c_calc;
            const y0 = v * k_c_calc;

            // General solution parameters (a'=a/d, b'=b/d)
            const a_prime = a / d;
            const b_prime = b / d;

            // Constraint calculations (x >= 0 and y >= 0)
            // x = x0 + k * b' >= 0  =>  k * b' >= -x0  => k >= -x0 / b'
            const k_min_float = -x0 / b_prime;
            // y = y0 - k * a' >= 0  =>  -k * a' >= -y0  => k * a' <= y0  => k <= y0 / a'
            const k_max_float = y0 / a_prime;

            const k_min_int = Math.ceil(k_min_float);
            const k_max_int = Math.floor(k_max_float);

            // Minimization S = x + y = (x0 + y0) + k*(b' - a')
            let S_fixed = x0 + y0;
            let S_k_coeff = b_prime - a_prime;
            let k_optimal, S_min;
            let x_min, y_min;
            let finalAnswerBox = '';
            let newIndicationContent = '';
            
            // Check if positive solutions exist
            if (c % d === 0) { // Solvable Case
                if (k_min_int > k_max_int) {
                    // No positive solution exists (should be rare with the current parameter generation)
                    S_min = 'N/A';
                    x_min = 'N/A';
                    y_min = 'N/A';
                    finalAnswerBox = `<div class="final-answer-box failure">
                        <p><strong>Conclusion :</strong> Il n'existe aucune combinaison de sacs $(x \geq 0, y \geq 0)$ pour transporter ${c} kg.</p>
                    </div>`;
                } else {
                    // Positive solutions exist, find k_optimal for S_min
                    
                    if (S_k_coeff > 0) {
                        // S(k) is increasing, so min S is at min k
                        k_optimal = k_min_int;
                    } else if (S_k_coeff < 0) {
                        // S(k) is decreasing, so min S is at max k
                        k_optimal = k_max_int;
                    } else {
                        // S(k) is constant (b' = a'), any k works
                        k_optimal = k_min_int; 
                    }
                    
                    S_min = S_fixed + k_optimal * S_k_coeff;
                    x_min = x0 + k_optimal * b_prime;
                    y_min = y0 - k_optimal * a_prime;
                    
                    finalAnswerBox = `<div class="final-answer-box success">
                        <p><strong>R√©ponse Finale (Nombre minimum de sacs) :</strong></p>
                        <p>Le nombre minimum de sacs est $\\mathbf{S_{min} = ${S_min}}$.</p>
                        <p>Cela correspond √† une combinaison de $\\mathbf{x = ${x_min}}$ sacs de ${a} kg$ et $\\mathbf{y = ${y_min}}$ sacs de ${b} kg$.</p>
                    </div>`;
                }

                // Construction de la solution d√©taill√©e (P√©dagogique)
                solContent = `
                    <h3>Correction D√©taill√©e : Probl√®me √† Contraintes (L'√©quation : $${a}x + ${b}y = ${c}$)</h3>
                    <p><strong>1. Mod√©lisation et R√©solution G√©n√©rale :</strong></p>
                    <ul>
                        <li>L'√©quation est : $${a}x + ${b}y = ${c}$.</li>
                        <li>$\text{PGCD}(${a}, ${b}) = \\mathbf{${d}}$. $${c} / ${d} = ${k_c_calc}$. L'√©quation a des solutions.</li>
                        <li>Solution particuli√®re : $\\mathbf{x_0 = ${x0}}$, $\\mathbf{y_0 = ${y0}}$ (via B√©zout : $${a}(${u}) + ${b}(${v}) = ${d}$ et multiplication par ${k_c_calc}$).</li>
                        <li>Solution g√©n√©rale : $$\\mathcal{S} = \\{(${x0} + k \\cdot ${b_prime}, ${y0} - k \\cdot ${a_prime}) \\mid k \\in \\mathbb{Z} \\}$$</li>
                    </ul>

                    <p><strong>2. Contraintes (Solutions Positives) :</strong></p>
                    <p>Nous cherchons $k \in \mathbb{Z}$ tel que $x \geq 0$ et $y \geq 0$.</p>
                    $$x \\geq 0 \\implies ${x0} + k \\cdot ${b_prime} \\geq 0 \\implies k \\geq \\mathbf{${k_min_float.toFixed(2)}}$$
                    $$y \\geq 0 \\implies ${y0} - k \\cdot ${a_prime} \\geq 0 \\implies k \\leq \\mathbf{${k_max_float.toFixed(2)}}$$
                    <p>Puisque $k$ doit √™tre un entier, l'intervalle des valeurs possibles pour $k$ est $\\mathbf{[${k_min_int}, ${k_max_int}]}$.</p>
                    
                    <p><strong>3. Minimisation du nombre de sacs $S = x + y$ :</strong></p>
                    <p>La somme de sacs est $S = (x_0 + y_0) + k(b' - a') = \\mathbf{${S_fixed} + k \\cdot (${S_k_coeff})}$$.</p>
                    ${S_k_coeff > 0 ? `<p>Puisque le coefficient de $k$ est positif ($${S_k_coeff}$), $S(k)$ est croissante. La valeur minimale de $S$ est atteinte pour la valeur minimale de $k$ dans l'intervalle.</p> <p>Nous choisissons : $\\mathbf{k_{opt} = k_{min} = ${k_min_int}}$.</p> <p>En substituant $\\mathbf{k_{opt}}$ dans $S(k)$, on obtient : $S_{min} = ${S_fixed} + (${k_min_int}) \\cdot (${S_k_coeff}) = \\mathbf{${S_min}}$.</p> <p>Les valeurs de sacs correspondantes sont :</p> $$\\begin{cases} x = ${x0} + (${k_min_int}) \\cdot (${b_prime}) = \\mathbf{${x_min}} \\text{ sacs de } ${a} \\text{ kg} \\\\ y = ${y0} - (${k_min_int}) \\cdot (${a_prime}) = \\mathbf{${y_min}} \\text{ sacs de } ${b} \\text{ kg} \\end{cases}$$` : (S_k_coeff < 0 ? `<p>Puisque le coefficient de $k$ est n√©gatif ($${S_k_coeff}$), $S(k)$ est d√©croissante. La valeur minimale de $S$ est atteinte pour la valeur maximale de $k$ dans l'intervalle.</p> <p>Nous choisissons : $\\mathbf{k_{opt} = k_{max} = ${k_max_int}}$.</p> <p>En substituant $\\mathbf{k_{opt}}$ dans $S(k)$, on obtient : $S_{min} = ${S_fixed} + (${k_max_int}) \\cdot (${S_k_coeff}) = \\mathbf{${S_min}}$.</p> <p>Les valeurs de sacs correspondantes sont :</p> $$\\begin{cases} x = ${x0} + (${k_max_int}) \\cdot (${b_prime}) = \\mathbf{${x_min}} \\text{ sacs de } ${a} \\text{ kg} \\\\ y = ${y0} - (${k_max_int}) \\cdot (${a_prime}) = \\mathbf{${y_min}} \\text{ sacs de } ${b} \\text{ kg} \\end{cases}$$` : `<p>Puisque le coefficient de $k$ est nul ($b' = a'$), la somme $S = x+y$ est constante, √©gale √† $\\mathbf{${S_fixed}}$.</p> <p>Nous choisissons la plus petite valeur de $k$ possible : $\\mathbf{k_{opt} = k_{min} = ${k_min_int}}$.</p> <p>Les valeurs de sacs correspondantes sont :</p> $$\\begin{cases} x = ${x0} + (${k_min_int}) \\cdot (${b_prime}) = \\mathbf{${x_min}} \\text{ sacs de } ${a} \\text{ kg} \\\\ y = ${y0} - (${k_min_int}) \\cdot (${a_prime}) = \\mathbf{${y_min}} \\text{ sacs de } ${b} \\text{ kg} \\end{cases}$$`)}
                    
                    ${finalAnswerBox}
                `;

                // Correction : Le contenu de l'indication est mis √† jour s√©par√©ment.
                newIndicationContent = `<p id="ex3-indication-content"><strong>Indication :</strong> L'√©quation est $${a}x + ${b}y = ${c}$. La solution g√©n√©rale est $\\mathcal{S} = \\{(${x0} + k \\cdot ${b_prime}, ${y0} - k \\cdot ${a_prime}) \\mid k \\in \\mathbb{Z} \\}$. D√©terminez la plage de valeurs de $k$ pour que $x \\geq 0$ et $y \\geq 0$.</p>`;
            
            } else { // Non solvable case
                questionListHTML = `
                    <li><strong>Mod√©lisation :</strong> √âcrire l'√©quation diophantienne lin√©aire mod√©lisant le probl√®me, o√π $x$ est le nombre de sacs de ${a} kg et $y$ est le nombre de sacs de ${b} kg.</li>
                    <li><strong>V√©rification :</strong> Prouver que l'√©quation n'admet pas de solution.</li>
                `;
                 solContent = `
                    <h3>Correction D√©taill√©e : Cas Non R√©soluble</h3>
                    <p><strong>1. Mod√©lisation :</strong></p>
                    <p>L'√©quation est : $${a}x + ${b}y = ${c}$.</p>
                    <p><strong>2. Condition d'Existence des solutions :</strong></p>
                    <p>L'√©quation admet des solutions dans $\\mathbb{Z}^2$ si et seulement si $\\text{PGCD}(a, b)$ divise $c$.</p>
                    <p>On calcule $\\text{PGCD}(${a}, ${b}) = \\mathbf{${d}}$.</p>
                    <p>Puisque $\\text{PGCD}(${a}, ${b}) = ${d}$ ne divise pas $${c}$ (car ${c} \\bmod ${d} = ${c % d} \neq 0$), l'√©quation n'admet <strong>aucune</strong> solution dans $\\mathbb{Z}^2$.</p>
                    <div class="final-answer-box failure">
                        Il est impossible de transporter la masse exacte de $${c}$ kg, car $${c}$ n'est pas divisible par le $\\text{PGCD}(${a}, ${b}) = ${d}$.
                    </div>
                `;
                // Correction : Le contenu de l'indication est mis √† jour s√©par√©ment.
                newIndicationContent = `<p id="ex3-indication-content"><strong>Indication :</strong> Calculer $\\text{PGCD}(${a}, ${b})$ et v√©rifier s'il divise $${c}$.</p>`;
            }

            // Mise √† jour finale et affichage MathJax
            document.getElementById('ex3-question-list').innerHTML = questionListHTML;
            document.getElementById('ex3-solution-content').innerHTML = solContent;
            
            // √âtape de correction : On met √† jour le contenu de l'indication statique avec les param√®tres du nouvel exercice.
            document.getElementById('ex3-indication-content').innerHTML = newIndicationContent;
            
            // Masquer l'aide et r√©initialiser le bouton lors de la g√©n√©ration
            document.getElementById('help-ex3-ind1').style.display = 'none';
            document.getElementById('help-ex3-sol1').style.display = 'none';
            document.querySelector('#container-ex3 [data-content-id="help-ex3-ind1"]').textContent = 'Indication';
            document.querySelector('#container-ex3 [data-content-id="help-ex3-ind1"]').style.backgroundColor = '#ffcc00';
            document.querySelector('#container-ex3 [data-content-id="help-ex3-sol1"]').textContent = 'Solution (D√©taill√©e)';
            document.querySelector('#container-ex3 [data-content-id="help-ex3-sol1"]').style.backgroundColor = '#33cc33';

            // Assure le rendu MathJax pour la question, la solution ET l'indication (corrig√© pour inclure help-ex3-ind1)
            if (window.MathJax) {
                MathJax.typeset([document.getElementById('ex3-question-list'), document.getElementById('help-ex3-sol1'), document.getElementById('help-ex3-ind1')]);
            }
        }


        // --- Initialisation au chargement de la page ---\r\n
        document.addEventListener('DOMContentLoaded', () => {
            // Lancement du premier probl√®me dynamique (Ex 1, Ex 2 et Ex 3)
            if (typeof generateNewDiophantineProblem === 'function') {
                generateNewDiophantineProblem();
            }
            if (typeof generateNonSolvableProblem === 'function') {
                generateNonSolvableProblem();
            }
            if (typeof generateNewContrainedProblem === 'function') {
                generateNewContrainedProblem();
            }
            
            // Re-typeset initial pour les formules LaTeX statiques (cours)
            if (window.MathJax) {
                MathJax.typeset();
            }
        });
    </script>
</body>
</html>